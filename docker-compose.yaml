services:
  kedge:
    build: .
    command: serve --repo ${KEDGE_REPO} --project ${KEDGE_PROJECT:-kedge} --branch ${KEDGE_BRANCH:-main}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - kedge-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "kedge", "healthcheck"]
      interval: 30s
      timeout: 5s
      retries: 3

volumes:
  kedge-data:
